// Copyright Edgar Costa 2019
// See LICENSE file for license details.
/*
 * Make up a degree 2 L-function associated to the classical modular form 23.1.b.a
 * https://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/25/12/a/a/
 *
 * Change the following two lines, to modify the number of decimal digits printed, or to print raw format (not human friendly)
 */
#define DIGITS 20
#define RAW false
/*
 * with DIGITS = 20 and RAW = False, running this file should generate something
 * comparable to:
Order of vanishing = 0
Epsilon = (1 + 0j)  +/-  (2.52e-114, 2.24e-57j)
First non-zero Taylor coeff = 0.33298177148293397364 +/- 8.2499e-57
L(1) = (0.19673558706889585505 + 5.1688917606710579456e-57j)  +/-  (1.16e-38, 1.16e-38j)
L(2) = (0.46721176888437312394 - 1.2275191787387591289e-56j)  +/-  (2.75e-38, 2.75e-38j)
First 10 zeros
Zero 0 = 7.2145891812871844435 +/- 1.3364e-51
Zero 1 = 9.2568107485814985876 +/- 1.0691e-50
Zero 2 = 10.580974854111851196 +/- 1.3685e-48
Zero 3 = 12.965859683008166209 +/- 1.3685e-48
Zero 4 = 15.648104672594291642 +/- 7.0065e-46
Zero 5 = 16.796003155249041724 +/- 7.0065e-46
Zero 6 = 18.404976306799735748 +/- 1.121e-44
Zero 7 = 19.213914502107617614 +/- 8.9683e-44
Zero 8 = 20.72321683128359949 +/- 1.7937e-43
Zero 9 = 22.543649261523556672 +/- 1.1479e-41
Z-plot in [0, 10]:
0.00	0.33	                              |-o
0.50	0.36	                              |-o
1.00	0.45	                              |--o
1.50	0.61	                              |---o
2.00	0.85	                              |-----o
2.50	1.18	                              |-------o
3.00	1.58	                              |----------o
3.50	2.04	                              |--------------o
4.00	2.49	                              |-----------------o
4.50	2.86	                              |--------------------o
5.00	3.01	                              |---------------------o
5.50	2.85	                              |--------------------o
6.00	2.32	                              |----------------o
6.50	1.45	                              |---------o
7.00	0.43	                              |--o
7.21	zero	                              Z
7.50	-0.49	                           o--|
8.00	-1.00	                       o------|
8.50	-0.94	                       o------|
9.00	-0.37	                            o-|
9.26	zero	                              Z
9.50	0.32	                              |-o
10.00	0.63	                              |---o
 */
#define __STDC_FORMAT_MACROS
#include <chrono>
#include <cstdint>
#include <cwctype>
#include <iomanip>
#include <iostream>
#include <fstream>
#include <map>
#include <set>
#include <sstream>
#include <string>
#include <vector>
#include <flint/fmpz.h>
#include <flint/fmpzxx.h>
#include <acb_poly.h>
#include "glfunc.h"
#include "examples_tools.h"

using flint::fmpzxx;
using std::cout;
using std::endl;
using std::int64_t;
using std::map;
using std::ostream;
using std::size_t;
using std::vector;


// such dictionary can be obtained directly from the sidebar
// https://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/25/12/a/a/
map<int64_t, vector<string>> euler_factors  ={
{ 2, { "1", "34", "2048" } },
{ 3, { "1", "-792", "177147" } },
{ 5, { "1" } },
{ 7, { "1", "-17556", "1977326743" } },
{ 11, { "1", "468788", "285311670611" } },
{ 13, { "1", "-374042", "1792160394037" } },
{ 17, { "1", "-3724286", "34271896307633" } },
{ 19, { "1", "379460", "116490258898219" } },
{ 23, { "1", "-32458092", "952809757913927" } },
{ 29, { "1", "-69696710", "12200509765705829" } },
{ 31, { "1", "-171448632", "25408476896404831" } },
{ 37, { "1", "-291340546", "177917621779460413" } },
{ 41, { "1", "-191343242", "550329031716248441" } },
{ 43, { "1", "-1759857392", "929293739471222707" } },
{ 47, { "1", "1623469924", "2472159215084012303" } },
{ 53, { "1", "-644888642", "9269035929372191597" } },
{ 59, { "1", "-925569220", "30155888444737842659" } },
{ 61, { "1", "10898589338", "43513917611435838661" } },
{ 67, { "1", "3795674064", "122130132904968017083" } },
{ 71, { "1", "22966943728", "231122292121701565271" } },
{ 73, { "1", "9880820458", "313726685568359708377" } },
{ 79, { "1", "20768886240", "747993810527520928879" } },
{ 83, { "1", "3204862008", "1287831418538085836267" } },
{ 89, { "1", "-63176321130", "2775173073766990340489" } },
{ 97, { "1", "126494473874", "7153014030880804126753" } },
{ 101, { "1", "-32890510302", "11156683466653165551101" } },
{ 103, { "1", "76222392308", "13842338707244455781047" } },
{ 107, { "1", "55856572344", "21048519522998348950643" } },
{ 109, { "1", "166136788330", "25804264053054077850709" } },
{ 113, { "1", "-179451654542", "38358611506121121577937" } },
{ 127, { "1", "-53794877516", "138624799340320978519423" } },
{ 131, { "1", "-531507278532", "194977389846841709335931" } },
{ 137, { "1", "392827630554", "319099584516184696444313" } },
{ 139, { "1", "1046036929420", "374250856383374715683539" } },
{ 149, { "1", "-445288935950", "803616698647447868139149" } },
{ 151, { "1", "-266614824352", "930564370500844495614151" } },
{ 157, { "1", "-1619587062106", "1428552404463186019525093" } },
{ 163, { "1", "1557118038008", "2158060662623960090407387" } },
{ 167, { "1", "-810193869636", "2817611963463158891460983" } },
{ 173, { "1", "-3629196921642", "4154388758501693990272277" } },
{ 179, { "1", "3783829650740", "6044819549314706693299979" } },
{ 181, { "1", "26382760018", "6830686029298982514463981" } },
{ 191, { "1", "-3188489846792", "12341474201974794188822591" } },
{ 193, { "1", "-2172552458542", "13839818640542834852821057" } },
{ 197, { "1", "3090424396974", "17343170265605241347130653" } },
{ 199, { "1", "-4506273184600", "19381341794579313317802199" } },
{ 211, { "1", "10473937938988", "36906852424971083485992811" } },
{ 223, { "1", "-3637981404292", "67819329772617336566541727" } },
{ 227, { "1", "16586396582384", "82467803819583117066183323" } },
{ 229, { "1", "10279797623490", "90821841990842470457948029" } },
{ 233, { "1", "2927599746858", "109879109551310452512114617" } },
{ 239, { "1", "-13396011338080", "145337240630172360933794639" } },
{ 241, { "1", "16728195115358", "159289617104504228485730641" } },
{ 251, { "1", "-18833877060252", "249121342886682932269065251" } },
{ 257, { "1", "-1201563096606", "323045991615992848448948993" } },
{ 263, { "1", "3796600489508", "416402409029831470623291287" } },
{ 269, { "1", "25742245602410", "533672814240301731473788469" } },
{ 271, { "1", "-16014429593272", "578978183833808423828407471" } },
{ 277, { "1", "-23161973367666", "736677591779499338860277773" } },
{ 281, { "1", "-37179665661882", "862520684644188385040795081" } },
{ 283, { "1", "9578058412608", "932504187587662529970024067" } },
{ 293, { "1", "-65105235871842", "1366292938960993269291344957" } },
{ 307, { "1", "-33787161085856", "2283085260392025651955298443" } },
{ 311, { "1", "-31326789581712", "2632475144332304877738303911" } },
{ 313, { "1", "63902725450058", "2824800055000021240134845737" } },
{ 317, { "1", "11551720535414", "3248268229328068909082939333" } },
{ 331, { "1", "-117396489617532", "5225260318375411481909498131" } },
{ 337, { "1", "3673996841554", "6366912912781415703444512113" } },
{ 347, { "1", "-59296596491576", "8782622634578054336274824003" } },
{ 349, { "1", "96915614965850", "9355773444073799096880141349" } },
{ 353, { "1", "39359396659458", "10605270721642531610378603297" } },
{ 359, { "1", "53849513174280", "12765532462721932175857515959" } },
{ 367, { "1", "45567121790964", "16267720676218928340423448783" } },
{ 373, { "1", "169341209790958", "19444516557322886668124300077" } },
{ 379, { "1", "59380200441740", "23175617242259741753050742179" } },
{ 383, { "1", "121002509761308", "26012764767708918581052067967" } },
{ 389, { "1", "-153361697488830", "30863531265827924755035773789" } },
{ 397, { "1", "133061282073574", "38609624189220868855209238453" } },
{ 401, { "1", "125079682705998", "43111000196969091338568804401" } },
{ 409, { "1", "-191901522661370", "53574285543133366239295624009" } },
{ 419, { "1", "339088245781060", "69880218238265974987208422619" } },
{ 421, { "1", "-409834586687422", "73638181357622863863877426621" } },
{ 431, { "1", "558967690788168", "95334473350473334338476729231" } },
{ 433, { "1", "-325999693255742", "100315226918403349419823702417" } },
{ 439, { "1", "-89133625453480", "116710444381569143360604716839" } },
{ 443, { "1", "555014045773008", "128955832196077553484700318307" } },
{ 449, { "1", "241404543824750", "149523602156362812588586992449" } },
{ 457, { "1", "36095403680794", "181584260108050775997625896793" } },
{ 461, { "1", "-258826949138262", "199852773331011222243920083061" } },
{ 463, { "1", "-564822897844692", "209599817996529430739834959087" } },
{ 467, { "1", "-388269793297936", "230401703744465269881211992683" } },
{ 479, { "1", "-264818742090960", "304572471562968542123015813279" } },
{ 487, { "1", "-960424464775396", "365442096185077415058791025463" } },
{ 491, { "1", "-237919600117292", "399849367486819482609834395891" } },
{ 499, { "1", "926509083889700", "477645842414670666895611255499" } },
{ 503, { "1", "-221172315836092", "521492222311601429966591196647" } },
{ 509, { "1", "222666755375930", "594149321766565107986044015109" } },
{ 521, { "1", "1004490588837478", "767741392900401760208994397721" } },
{ 523, { "1", "-1019538444892592", "800789882655737251012174233427" } },
{ 541, { "1", "-1576723717969542", "1161903115387181386900143203941" } },
{ 547, { "1", "-273963507086576", "1311778745001927027370820531803" } },
{ 557, { "1", "91000471705494", "1601058302059584837582353420693" } },
{ 563, { "1", "102926393251608", "1801326106912561394974093742987" } },
{ 569, { "1", "-2339556432974490", "2024113821105820389305131081769" } },
{ 571, { "1", "226931239783828", "2103764831220211147045849420771" } },
{ 577, { "1", "2421511880192834", "2360119236655341373266124769473" } },
{ 587, { "1", "1604253787184904", "2851143746359947452906740409363" } },
{ 593, { "1", "-2020528622020942", "3188611638929330712224580716657" } },
{ 599, { "1", "-1257878419261400", "3562009277529968810387620206599" } },
{ 601, { "1", "850069615091398", "3695040407505879039923659806601" } },
{ 607, { "1", "-2257710792441356", "4121692631302365092279372570143" } },
{ 613, { "1", "3375833969205358", "4592669775783920736778231997437" } },
{ 617, { "1", "-1761143658313686", "4933291799952117279127519871033" } },
{ 619, { "1", "536922678085660", "5112074086881623076996824584819" } },
{ 631, { "1", "1361520603114368", "6314267138338848586317495491431" } },
{ 641, { "1", "2148959139283758", "7506514445791062595879589895041" } },
{ 643, { "1", "-557356122582792", "7768205433717376298112278666107" } },
{ 647, { "1", "241894180790524", "8316624386164136054632388935703" } },
{ 653, { "1", "-3139585213786042", "9205449376372141424226031714997" } },
{ 659, { "1", "-1061987922234220", "10179807381805722116509203289259" } },
{ 661, { "1", "887576148441938", "10524853377022476462245292805261" } },
{ 673, { "1", "-2923985063350542", "12828199533904631006539357591777" } },
{ 677, { "1", "-3201435506787666", "13692266880844888377187354333373" } },
{ 683, { "1", "2374358013548208", "15087863296794400779633937999667" } },
{ 691, { "1", "446381960099708", "17149778732316897228172675278091" } },
{ 701, { "1", "-5799298780282502", "20086219191438000565629621957701" } },
{ 709, { "1", "-3711496215295870", "22756663464120116199753794497309" } },
{ 719, { "1", "-254073503735040", "26547143305255898455187983015919" } },
{ 727, { "1", "3407257530559484", "29983237126533002627699290002823" } },
{ 733, { "1", "-3167081741102842", "32820388764059014706376078334117" } },
{ 739, { "1", "-3825929969969980", "35899534922627225998791047850139" } },
{ 743, { "1", "-2209953962739692", "38095787132698332573669273790007" } },
{ 751, { "1", "-1226064105604552", "42858730914417052610343077820751" } },
{ 757, { "1", "6709291091329294", "46779402942929633347037036568493" } },
{ 761, { "1", "5226981453900438", "49571404567244789521046926816361" } },
{ 769, { "1", "-9722515805477090", "55614717793339117396720595443969" } },
{ 773, { "1", "9828292307784558", "58880899117397849864481203955677" } },
{ 787, { "1", "2540306642769904", "71733505719539585795878718277163" } },
{ 797, { "1", "-3634047718991626", "82421693827554704605804957854053" } },
{ 809, { "1", "4024893340628230", "97147971723336173619258376588409" } },
{ 811, { "1", "11209452324103188", "99822719274255895242048251359411" } },
{ 821, { "1", "21142690373861778", "114228566926184776714935039911021" } },
{ 823, { "1", "-3765892141086892", "117327059769435148914666815625127" } },
{ 827, { "1", "1794186154640584", "123754387509093132323753421866723" } },
{ 829, { "1", "11161486852296090", "127086621963831927815730676274629" } },
{ 839, { "1", "-3475139435319080", "145004529710863056816442205361239" } },
{ 853, { "1", "16412214205681758", "173955971978073793782614248622797" } },
{ 857, { "1", "4919205017661994", "183142459050954998047340972192393" } },
{ 859, { "1", "19688991000557180", "187899144227561729924334314971459" } },
{ 863, { "1", "24406755096212108", "197751029380134624572872961894687" } },
{ 877, { "1", "28874389996366134", "236045392179100086342617165561173" } },
{ 881, { "1", "2519277239619518", "248161835410152216961189323881681" } },
{ 883, { "1", "-22947853053776392", "254429661043611087706931461787467" } },
{ 887, { "1", "-31202872587089796", "267399024236761792276534326761063" } },
{ 907, { "1", "7971313059821544", "341727679615113273579818959141843" } },
{ 911, { "1", "21501767879960888", "358675858688244940517539534270511" } },
{ 919, { "1", "19363824928436360", "394884989266957853236255950578119" } },
{ 929, { "1", "17850530406099790", "444808270774598905774855286645729" } },
{ 937, { "1", "7465052912682954", "488804842538159781006315881515513" } },
{ 941, { "1", "-30598421763809942", "512254589011563714814805672568341" } },
{ 947, { "1", "-23513751983906976", "549350809785675865253538956347403" } },
{ 953, { "1", "14874428064538858", "588873359016504486675291861526697" } },
{ 967, { "1", "-47403930542122036", "691339251202071082784388980212183" } },
{ 971, { "1", "12108312753504228", "723455010776824500718948741505171" } },
{ 977, { "1", "-52395212022280766", "774176886221345024403798127225073" } },
{ 983, { "1", "36425353018854708", "828111271973355615696218673631367" } },
{ 991, { "1", "-42108794710093592", "905336853093316443669161352351391" } },
{ 997, { "1", "27520915894982574", "967490571618070077371483084361853" } },
};




// compute the Euler poly for p
// just uses the map above
void lpoly_callback(acb_poly_t poly, uint64_t p, int d __attribute__((unused)), int64_t prec __attribute__((unused)), void *param __attribute__((unused)))
{
  acb_poly_zero(poly);
  auto it = euler_factors.find(p);
  fmpz_t z;
  acb_t b;
  fmpz_init(z);
  acb_init(b);
  if( it != euler_factors.end() ) {
    for(size_t i = 0; i < it->second.size(); ++i) {
      fmpz_set_str(z, it->second[i].c_str(), 10);
      acb_set_fmpz(b, z);
      acb_poly_set_coeff_acb(poly, i, b);
    }
  }
  fmpz_clear(z);
  acb_clear(b);
}




int main ()
{
  Lfunc_t L;
  double mus[2] = {0, 1};
  Lerror_t ecode;

  // we have a degree 2 L-function with motivic weight 2
  L = Lfunc_init(2, 25, 5.5, mus, &ecode);
  if(fatal_error(ecode))
  {
    fprint_errors(stderr,ecode);
    return 0;
  }

  // populate local factors
  ecode |= Lfunc_use_all_lpolys(L, lpoly_callback, NULL);
  if(fatal_error(ecode))
  {
    fprint_errors(stderr, ecode);
    return 0;
  }

  // do the computation
  ecode|=Lfunc_compute(L);
  if(fatal_error(ecode))
  {
    fprint_errors(stderr,ecode);
    return 0;
  }

  // now extract some information
  printf("Order of vanishing = %" PRIu64 "\n",Lfunc_rank(L));
  printf("Epsilon = ");
  acb_printd(Lfunc_epsilon(L),DIGITS);
  printf("\n");
  if (RAW) cout<<"RAW: "<<Lfunc_epsilon(L) << endl;
  printf("First non-zero Taylor coeff = ");
  arb_printd(Lfunc_Taylor(L),DIGITS);
  printf("\n");
  if (RAW) cout<<"RAW: "<<Lfunc_Taylor(L) << endl;


  acb_t ctmp;
  acb_init(ctmp);
  ecode|=Lfunc_special_value(ctmp, L, 1.0, 0.0);
  if(fatal_error(ecode)) {
    fprint_errors(stderr,ecode);
    std::abort();
  }
  printf("L(1) = ");acb_printd(ctmp, DIGITS);printf("\n");
  if (RAW) cout<<"RAW: "<<ctmp << endl;
  ecode|=Lfunc_special_value(ctmp, L, 2,0.0);
  if(fatal_error(ecode)) {
    fprint_errors(stderr, ecode);
    std::abort();
  }
  printf("L(2) = ");acb_printd(ctmp, DIGITS);printf("\n");
  acb_clear(ctmp);

  printf("First 10 zeros\n");
  // we could use Lfunc_zeros(L, 1) for the dual L-function
  arb_srcptr zeros=Lfunc_zeros(L, 0);
  for(int i  = 0; i < 10; ++i) {
    printf("Zero %d = ", i);
    arb_printd(zeros+i, DIGITS);
    printf("\n");
    if (RAW) cout<<"RAW: "<<zeros + i<< endl;
  }

  printf("Z-plot in [0, 10]:\n");
  Lplot_t *Lpp=Lfunc_plot_data(L, 0, 50.0, 20);
  int z = 0;
  double zero_double = arf_get_d(arb_midref(zeros + z), ARF_RND_NEAR);
  for(size_t k=0; k < Lpp->n_points; ++k) {
    printf("%.2f\t%.2f\t", k*Lpp->spacing , Lpp->points[k]);
    int y = 30 + int(7.5*Lpp->points[k]);
    int zero = 30;
    // assuming 60 columns
    for(int i = 0; i < 61; ++i) {
      if(i == y) {
        printf("o");
      } else if (i == zero) {
        printf("|");
      } else if ( (i > zero and i < y) or (i < zero and i > y) ) {
        printf("-");
      } else {
        printf(" ");
      }
    }
    printf("\n");
    if(k*Lpp->spacing < zero_double and (k+1)*Lpp->spacing >= zero_double){
      printf("%.2f\tzero\t", zero_double);
      for(int i = 0; i < 30; ++i)
        printf(" ");
      printf("Z\n");
      zero_double = arf_get_d(arb_midref(zeros + ++z), ARF_RND_NEAR);
    }
  }

  //free memory
  Lfunc_clear_plot(Lpp);
  Lfunc_clear(L);

  // print any warnings collected along the way
  fprint_errors(stderr,ecode);

  return 0;
}
